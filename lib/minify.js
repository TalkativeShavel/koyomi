/*
 * Koyomi.js v0.2.0
 * Copyright(c) 2015 Yuki Kurata <yuki.kurata@gmail.com>
 * MIT Licensed
 */
var Koyomi=function(){function e(e){e=e||{},Object.defineProperty(this,"_defaultFormat",{value:null,writable:!0}),Object.defineProperty(this,"_defaultFormatInput",{value:null,writable:!0}),this.defaultFormat=e.defaultFormat||w,Object.defineProperty(this,"_regularHoliday",{value:null,writable:!0}),Object.defineProperty(this,"_regularHolidayInput",{value:null,writable:!0}),this.regularHoliday=e.regularHoliday||T,Object.defineProperty(this,"_seasonHoliday",{value:null,writable:!0}),Object.defineProperty(this,"_seasonHolidayInput",{value:null,writable:!0}),this.seasonHoliday=e.seasonHoliday||M,this.holidayOpened=e.holidayOpened||!1,this.startMonth=e.startMonth||1,this.startWeek=e.startWeek||"月",this.six=e.six||!0}function t(e,t){return(e=d(e))?(t=t||w,~t.indexOf("{")||(t=t.replace(K,function(e){return"{"+e+"}"})),t.replace(X,function(t,n){return n in F?F[n](e):t})):""}function n(e,t){e=d(e,!1,!0);var n=Object.keys(q),r=[];t.replace(B,"").replace(Q,function(e,t,i){return n.some(function(e){return i=i.toLowerCase(),~q[e].indexOf(i)?(r.push([e,1*t]),!0):!1}),""});var i;return r.forEach(function(t){switch(t[0]){case"d":e.setTime(e.getTime()+j*t[1]);break;case"h":e.setTime(e.getTime()+N*t[1]);break;case"i":e.setTime(e.getTime()+x*t[1]);break;case"y":i=e.getDate(),e=new Date(e.getFullYear()+t[1],e.getMonth(),i,e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()),i!==e.getDate()&&e.setTime(e.getTime()-j);break;case"m":i=e.getDate(),e=new Date(e.getFullYear(),e.getMonth()+t[1],i,e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()),i!==e.getDate()&&e.setTime(e.getTime()-e.getDate()*j);break;case"w":e.setTime(e.getTime()+Y*t[1]);break;case"s":e.setTime(e.getTime()+_*t[1]);break;case"ms":e.setTime(e.getTime()+t[1])}}),e}function r(e){return e=d(e),new Date(e.getFullYear(),e.getMonth(),1)}function i(e){return e=d(e),new Date(e.getFullYear(),e.getMonth()+1,0)}function u(e,t){var n=d(e,!0),r=d(t,!0);return n&&r?(r.getTime()-n.getTime())/j:null}function a(e,t){var n=d(e),r=d(t),i=new Date;if(n)n=new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds());else{if("string"!=typeof e)return null;var u=e.match(U);if(!u)return null;n=new Date(i.getFullYear(),i.getMonth(),i.getDate(),1*u[1],1*(u[2]||0),1*(u[3]||0))}if(r)r=new Date(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds());else{if("string"!=typeof t)return null;var a=t.match(U);if(!a)return null;r=new Date(i.getFullYear(),i.getMonth(),i.getDate(),1*a[1],1*(a[2]||0),1*(a[3]||0))}return(r.getTime()-n.getTime())/_}function o(e){e=d(e);var t=100*(e.getMonth()+1)+e.getDate(),n=l(e.getFullYear());return n[t]||null}function l(e){var t=V[e];return t?t:(t={},k.forEach(function(n){var r;switch(n){case"春分の日":r=f(e);break;case"秋分の日":r=c(e);break;default:r=s(e,n)}if(r){var i=100*r[0]+r[1];t[i]=r[2]}}),~k.indexOf("振替休日")&&g(e,t),~k.indexOf("国民の休日")&&h(e,t),V[e]=t,t)}function s(e,t){for(var n=t.match(/(\S+)/g),r=n[0],i=1;i<n.length;i++){var u=n[i].match(Z);if(u){var a=1*u[4],o=1*u[1],l=1*(u[3]||(u[2]?e:o)),s=u[6]?p(e,a,u[5],u[6]):1*u[5];if(e>=o&&l>=e)return[a,s,r]}}return null}function f(e){if(1949>e||e>2099)return null;var t;switch(e%4){case 0:t=1956>=e?21:2088>=e?20:19;break;case 1:t=1989>=e?21:20;break;case 2:t=2022>=e?21:20;break;case 3:t=1923>=e?22:2055>=e?21:20}return[3,t,"春分の日"]}function c(e){if(1948>e||e>2099)return null;var t;switch(e%4){case 0:t=2008>=e?23:22;break;case 1:t=1917>=e?24:2041>=e?23:22;break;case 2:t=1946>=e?24:2074>=e?23:22;break;case 3:t=1979>=e?24:23}return[9,t,"秋分の日"]}function g(e,t){if(!(1973>e)){var n=null,r=[],i=new Date(1973,3,29).getTime(),u=!1,a=Object.keys(t);a.push("1231"),a.forEach(function(t){var a=new Date(e,1*t.slice(0,-2)-1,1*t.slice(-2));u?(n.setTime(n.getTime()+j),n.getTime()!==a.getTime()&&(r.push(100*(n.getMonth()+1)+n.getDate()),u=!1)):u=0===a.getDay()&&i<=a.getTime(),n=a}),r.forEach(function(e){t[e]="振替休日"})}}function h(e,t){if(!(1988>e)){var n=[],r=null;Object.keys(t).forEach(function(t){var i=new Date(e,1*t.slice(0,-2)-1,1*t.slice(-2));r&&(r.setTime(r.getTime()+j),r.getTime()+j===i.getTime()&&n.push(100*(r.getMonth()+1)+r.getDate())),r=i}),n.forEach(function(e){e in t||(t[e]="国民の休日")})}}function d(e,t,n){if(!e)return null;if(e instanceof Date)!t&&n&&(e=new Date(e.getTime()));else if("string"==typeof e)e=e.replace(L,function(e,t,n,r,i){var u=parseInt(R.indexOf(t)/2,10);return H[u].y+1*n-1+"-"+r+"-"+i}),e=new Date(e);else if(Array.isArray(e)){var r=[0,1,1,0,0,0,0];e.forEach(function(e,t){r[t]=e}),e=new Date(r[0],r[1]-1,r[2],r[3],r[4],r[5],r[6])}else{if(!("object"==typeof e&&"year"in e&&"month"in e&&"day"in e))return null;e=new Date(e.year,e.month-1,e.day)}return Number.isNaN(e.getTime())?null:t?new Date(e.getFullYear(),e.getMonth(),e.getDate()):e}function y(e){if(!e)return null;if(Array.isArray(e)){var t=e.map(function(e){return C.indexOf(e.trim().toLowerCase())%7}).filter(function(e){return~e});return t.length?t:null}if("string"==typeof e){if(~e.indexOf(","))return y(e.split(",").map(function(e){return e.trim()}));var n=C.indexOf(e.toLowerCase())%7;return-1===n?null:n}return null}function m(e){var t=[];return e.split(",").forEach(function(e){var n=e.trim().match(et);if(n&&n[3]){var r=1*n[1],i=1*n[2],u=1*n[3],a=1*n[4];for(r>u&&(u+=12);100*u+a>=100*r+i;)t.push(100*(r>12?r-12:r)+i),i>=31?(r++,i=1):i++}else n&&t.push(100*n[1]+1*n[2])}),t.filter(function(e){return!~tt.indexOf(e)})}function p(e,t,n,r){var i=C.indexOf(r.toLowerCase())%7;if(-1===i)return null;var u=new Date(e,t-1,1).getDay(),a=1+i-u+(u>i?7:0);if(n>4){var o=new Date(e,t,0).getDate();n=parseInt((o-a)/7,10)+1}return a+7*(n-1)}function v(e,t){e=d(e);var n=H[H.length-1],r=e.getFullYear();if(1873>r)return n;for(var i=0,u=H.length;u>i;i++){var a=H[i];if(t&&a.d<=e||!t&&a.y<=r)return a}return n}function D(e,t,n){if(e=d(e,!0),t="number"==typeof t?t:t?y(t):1,null===t)return null;n=n?n-1:0;var r=e.getFullYear(),i=e.getMonth();r=n>i?r-1:r;var u=new Date(r,n,1),a=(u.getDay()+7-t)%7,o=(e-u)/j+a;return Math.floor(o/7)+1}function b(e,t){if("number"!=typeof e)return"";if(0===e)return"〇";if(0>e||e>9999)return"";if(t)return(""+e).split("").map(function(e){return"0"===e?"〇":$[1*e]}).join("");var n=("0000"+e).slice(-4).split(""),r=1*n[0],i=1*n[1],u=1*n[2],a=1*n[3];return(0===r?"":1===r?"千":$[r]+"千")+(0===i?"":1===i?"百":$[i]+"百")+(0===u?"":1===u?"十":$[u]+"十")+(0===a?"":$[a])}var w="Y-m-d H:i:s",T="土,日",M="12/29-1/3",H=[{N:"平成",n:"H",y:1989,d:new Date("1989-01-08 00:00:00.000")},{N:"昭和",n:"S",y:1926,d:new Date("1926-12-25 00:00:00.000")},{N:"大正",n:"T",y:1912,d:new Date("1912-07-30 00:00:00.000")},{N:"明治",n:"M",y:1868,d:new Date("1868-01-25 00:00:00.000")},{N:"西暦",n:"",y:1,d:new Date("0001-01-01 00:00:00.000")}],k=["元日         1949-/1/1","成人の日     1949-1999/1/15  2000-/1/2mon","建国記念の日 1967-/2/11","春分の日","天皇誕生日   1949-1988/4/29","みどりの日   1989-2006/4/29","昭和の日     2007-/4/29","憲法記念日   1949-/5/3","みどりの日   2007-/5/4","こどもの日   1949-/5/5","海の日       1996-2002/7/20  2003-/7/3mon","山の日       2016-/8/11","敬老の日     1966-2002/9/15  2003-/9/3mon","秋分の日","体育の日     1966-1999/10/10 2000-/10/2mon","文化の日     1948-/11/3","勤労感謝の日 1948-/11/23","天皇誕生日   1989-/12/23","振替休日","国民の休日","皇太子・明仁親王の結婚の儀  1959/4/10","昭和天皇の大喪の礼          1989/2/24","即位の礼正殿の儀            1990/11/12","皇太子・徳仁親王の結婚の儀  1993/6/9"],F={hizuke:function(e){return this.Y(e)+"/"+this.m(e)+"/"+this.d(e)},wareki:function(e){return this.nengo(e)+this.nen(e)+"年"+this.n(e)+"月"+this.j(e)+"日"},wareki2:function(t){return e.format(t,"NengoNen年n月j日")},Y:function(e){return e.getFullYear()},y:function(e){return String(e.getFullYear()).slice(-2)},L:function(e){return 29===new Date(e.getFullYear(),1,29).getDate()?1:0},nengo:function(e){return v(e).N},nengo2:function(e){return v(e).n},nen:function(e){return e.getFullYear()-v(e).y+1},nen2:function(e){var t=e.getFullYear()-v(e).y+1;return 1===t?"元":t},nen3:function(e){var t=e.getFullYear()-v(e).y+1;return 1===t?"元":b(t,t>100)},nen4:function(e){var t=e.getFullYear()-v(e).y+1;return 1===t?"元":b(t,!0)},Nengo:function(e){return v(e,!0).N},Nengo2:function(e){return v(e,!0).n},Nen:function(e){return e.getFullYear()-v(e,!0).y+1},Nen2:function(e){var t=e.getFullYear()-v(e,!0).y+1;return 1===t?"元":t},Nen3:function(e){var t=e.getFullYear()-v(e,!0).y+1;return 1===t?"元":b(t,t>100)},Nen4:function(e){var t=e.getFullYear()-v(e,!0).y+1;return 1===t?"元":b(t,!0)},m:function(e){return("0"+(e.getMonth()+1)).slice(-2)},n:function(e){return e.getMonth()+1},F:function(e){return E[e.getMonth()]},M:function(e){return E[e.getMonth()].substring(0,3)},watuki:function(e){return S[e.getMonth()]},tuki:function(e){return b(e.getMonth()+1)},tuki2:function(e){return b(e.getMonth()+1,!0)},t:function(e){var t=new Date(e.getFullYear(),e.getMonth()+1,0);return t.getDate()},W:function(e){return D(e)},Wj:function(e){return D(e,"日",4)},d:function(e){return("0"+e.getDate()).slice(-2)},j:function(e){return e.getDate()},niti:function(e){return b(e.getDate())},niti2:function(e){return b(e.getDate(),!0)},S:function(e){return I[e.getDate()]},z:function(e){return Math.floor((e.getTime()-new Date(e.getFullYear(),0,1).getTime())/j)},w:function(e){return e.getDay()},N:function(e){return e.getDay()||7},l:function(e){return W[e.getDay()]},D:function(e){return A[e.getDay()]},yobi:function(e){return P[e.getDay()]},yobi2:function(e){return this.holiday(e)?"祝":this.yobi(e)},yobi3:function(e){var t=this.yobi2(e);return t+("祝"===t?"日":"曜日")},holiday:function(e){return o(e)||""},g:function(e){return e.getHours()%12},G:function(e){return e.getHours()},h:function(e){return("0"+e.getHours()%12).slice(-2)},H:function(e){return("0"+e.getHours()).slice(-2)},i:function(e){return("0"+e.getMinutes()).slice(-2)},i2:function(e){return e.getMinutes()},s:function(e){return("0"+e.getSeconds()).slice(-2)},s2:function(e){return e.getSeconds()},u:function(e){return("00"+e.getMilliseconds()).slice(-3)+"000"},a:function(e){return e.getHours()<12?"am":"pm"},A:function(e){return e.getHours()<12?"AM":"PM"},aj:function(e){return e.getHours()<12?"午前":"午後"}},O={Wn:function(e,t){return D(e,t.startWeek,t.startMonth)},eigyo:function(e,t){return t.isOpened(e)?this.yobi(e):"休"},eigyo2:function(e,t){var n=this.eigyo(e,t);return n+("休"===n?"業日":"曜日")},closed:function(e,t){return t.isHolidayClosed(e)?"祝日":t.isSeasonHoliday(e)?"休業日":t.isRegularHoliday(e)?"定休日":""}};Object.keys(F).forEach(function(e){O[e]=F[e]});var Y=6048e5,j=864e5,N=36e5,x=6e4,_=1e3,E="January,February,March,April,May,June,July,August,September,October,November,December".split(","),S="睦月,如月,弥生,卯月,皐月,水無月,文月,葉月,長月,神無月,霜月,師走".split(","),I="0,st,nd,rd,th,th,th,th,th,th,th,th,th,th,th,th,th,th,th,th,th,st,nd,rd,th,th,th,th,th,th,th,st".split(","),W="Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),A="Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),P="日月火水木金土".split(""),C=[].slice.call(W).concat(A).map(function(e){return e.toLowerCase()}).concat(P),$=",一,二,三,四,五,六,七,八,九".split(","),R=H.reduce(function(e,t){return t.n&&(e.push(t.N),e.push(t.n)),e},[]),L=new RegExp("^("+R.join("|")+")(\\d+)\\D+(\\d+)\\D+(\\d+)\\D*$"),J=Object.keys(F).sort(function(e,t){return t.length-e.length}),z=Object.keys(O).sort(function(e,t){return t.length-e.length}),K=new RegExp(J.join("|"),"g"),G=new RegExp(z.join("|"),"g");Object.defineProperty(e.prototype,"defaultFormat",{enumarable:!0,get:function(){return this._defaultFormatInput},set:function(e){this._defaultFormatInput=e,e=e||w,~e.indexOf("{")||(e=e.replace(G,function(e){return"{"+e+"}"})),this._defaultFormat=e}}),Object.defineProperty(e.prototype,"regularHoliday",{enumarable:!0,get:function(){return this._regularHolidayInput},set:function(e){if(this._regularHolidayInput=e,"function"==typeof e)this._regularHoliday=e.bind(this);else if("string"==typeof e){var t={};e=e.split(",").map(function(e){return e.trim()});var n=y(e);n&&(t.week=n);var r=/^\d{1,2}$/,i=e.map(function(e){return r.test(e)?1*e:0}).filter(function(e){return e>=1&&31>=e});i.length&&(t.day=i);var u=/^(\d)(.+)$/,a=e.map(function(e){var t=e.match(u);if(t){var n=1*t[1],r=y(t[2]);if(n>=1&&6>=n&&null!==r)return[n,r]}return null}).filter(function(e){return e});a.length&&(t.nyobi=a),this._regularHoliday=t}else this._regularHoliday="number"==typeof e&&e>=1&&31>=e?{day:[e]}:{}}}),Object.defineProperty(e.prototype,"seasonHoliday",{enumarable:!0,get:function(){return this._seasonHolidayInput},set:function(e){this._seasonHolidayInput=e,"function"==typeof e?this._seasonHoliday=e.bind(this):"string"==typeof e?(e=m(e),this._seasonHoliday=e.length?e:null):this._seasonHoliday=null}});var X=/\{(\w+)\}/g;e.format=t,e.prototype.format=function(e,t,n,r){var i=this;return(e=d(e))?("number"==typeof n&&(e=i.addEigyobi(e,n,r)),t=t||this._defaultFormat,~t.indexOf("{")||(t=t.replace(G,function(e){return"{"+e+"}"})),t.replace(X,function(t,n){return n in O?O[n](e,i):t})):""},e.params=Object.keys(F),e.prototype.params=Object.keys(O);var q={d:["d","days","day","日"],h:["h","hour","hours","時間"],i:["i","min","minute","minutes","分"],y:["y","age","year","years","年","ヶ年","か年","カ年","ケ年","箇年","個年"],m:["m","mo","mon","month","months","月","ヶ月","か月","カ月","ケ月","箇月","個月"],w:["w","week","weeks","週","週間"],s:["s","sec","second","seconds","秒"],ms:["ms","millisecond","milliseconds","ミリ秒"]},B=/[ 　,、]/g,Q=/([-+]?\d+)([^-+0-9]+)/gi;e.add=n,e.first=r,e.last=i,e.days=u;var U=/^(\d{1,2})\D+(?:(\d{1,2})(?:\D+(\d{1,2}))?)?\D*$/;e.seconds=a,e.prototype.addEigyobi=function(e,t,n){var r=this;if(e=d(e),!e)return null;0===t?(t=1,e.setTime(e.getTime()-j)):n&&e.setTime(e.getTime()+(t>0?-j:j));for(var i=365;t;)if(e.setTime(e.getTime()+(t>0?j:-j)),r.isOpened(e)&&(t=t>0?t-1:t+1),--i<0)return null;return e},e.prototype.toEigyobi=function(e,t,n){var r=this;if(e=d(e),!e)return null;if(0===t)return r.addEigyobi(e,-1,!0);var i=t>0?1:-1;e.setTime(e.getTime()+j*i);for(var u=365;t;)if(e.setTime(e.getTime()-j*i),r.isOpened(e)&&(t-=i),--u<0)return null;return n||e.setTime(e.getTime()-j*i),e},e.prototype.countEigyobi=function(e,t){var n=this;if(e=d(e,!0),t=d(t,!0),!e||!t)return null;if(t.getTime()<e.getTime())return null;for(var r=0;e.getTime()<=t.getTime();)n.isOpened(e)&&r++,e.setTime(e.getTime()+j);return r},e.prototype.isOpened=function(e){return e=d(e),this.isRegularHoliday(e)?!1:this.isSeasonHoliday(e)?!1:this.isHolidayClosed(e)?!1:!0},e.prototype.isRegularHoliday=function(e){e=d(e);var t=this._regularHoliday;if(!t)return!1;if("object"==typeof t){var n=t.week;if(n&&~n.indexOf(e.getDay()))return!0;var r=t.day;if(r&&~r.indexOf(e.getDate()))return!0;var i=t.nyobi;return i&&i.some(function(t){return e.getDay()===t[1]&&parseInt((e.getDate()+6)/7,10)===t[0]})?!0:!1}return"function"==typeof t?t(e):!1},e.prototype.isSeasonHoliday=function(e){e=d(e);var t=this._seasonHoliday;if(!t)return!1;if(Array.isArray(t)){var n=100*(e.getMonth()+1)+1*e.getDate();return-1!==t.indexOf(n)}return"function"==typeof t?t(e):!1},e.prototype.isHolidayClosed=function(e){return this.holidayOpened?!1:null!==o(e)};var V={};e.getHolidayName=o,e.getHolidays=l;var Z=new RegExp("^(?:(\\d+)(-)?(\\d+)?\\/)?(\\d+)\\/(\\d+)("+C.join("|")+")?$","i");e.prototype.getNendo=function(e){if(e=e?d(e):new Date,!e)return null;var t=e.getFullYear(),n=e.getMonth()+1,r=this.startMonth,i=1===r?12:r-1,u=r>n?t-1:t,a=1===r?u:u+1,o=new Date(u,r-1,1,0,0,0,0),l=new Date(a,i,0,23,59,59,999);return{from:o,to:l}},e.prototype.formatNendo=function(e,t,n,r){var i=this.getNendo(e||new Date),u=arguments.length<=1,a=arguments.length<=2;t=u?"{Y}/{n}":t,n=a?u?"-{Y}/{n}":null:n;var o=t?this.format(i.from,t):"",l=n?this.format(i.to,n):"";return r?l+o:o+l},e.prototype.getCalendarData=function(e,t,n){var r,i,u,a,o=this;if("number"==typeof e||/^\d{1,4}$/.test(e))r=1*e,i=1,u=1*e,a=12;else if("string"==typeof e){var l=/^(\d{1,4})\D+(\d{1,2})(?:\D+(\d{1,4})\D+(\d{1,2}))?$/,s=e.match(l);if(!s)return null;r=1*s[1],i=1*s[2],u=1*(s[3]||s[1]),a=1*(s[4]||s[2])}else{var f=this.getNendo();r=f.from.getFullYear(),i=f.from.getMonth()+1,u=f.to.getFullYear(),a=f.to.getMonth()+1}var c=void 0===t?y(o.startWeek):null===t?null:y(t),g=null===c?null:0===c?6:c-1;n=void 0!==n?n:o.six;for(var h,d=[],m=1;100*u+a>=100*r+i;){var p=new Date(r,i-1,1),v=p.getDay();null!==c&&(p=new Date(r,i-1,c-v-(v>=c?-1:6)));var D=new Date(r,i,0);if(n&&null!==c)D=new Date(p.getTime()+41*j);else if(null!==c){var b=D.getDay();D=new Date(r,i,c-b+(b>=c?6:-1))}var w=!0;for(h=0;;){var T=o.format(p,"{Y}|{n}|{j}|{w}|{closed}|{holiday}").split("|"),M={som:w,eom:!1,year:1*T[0],month:1*T[1],day:1*T[2],week:1*T[3],opened:!T[4],closed:T[4],holiday:T[5]};if(w=!1,null!==c&&(M.sow=c===1*T[3],M.eow=g===1*T[3],M.ghost=M.month!==i,M.block=r+"/"+("0"+i).slice(-2),M.sow&&(M.ghost?M.som||h++:m++),M.weekNumber=m+h),d.push(M),p.getTime()===D.getTime()){M.eom=!0;break}p.setTime(p.getTime()+j)}i=i>=12?1:i+1,r=1===i?r+1:r}return d},e.toDate=d,e.getWeekIndex=y;var et=/^(\d{1,2})\/(\d{1,2})(?:-(\d{1,2})\/(\d{1,2}))?$/,tt=[230,231,431,631,931,1131];return e.getDateArray=m,e.getXDay=p,e.getNengo=v,e.getWeekNumber=D,e.prototype.getWeekNumber=function(e){return 3===arguments.length&&(e=new Date(arguments[0],arguments[1]-1,arguments[2])),D(e,this.startWeek,this.startMonth)},e.kan=b,e}();"object"==typeof module&&"object"==typeof exports&&(module.exports=exports=Koyomi);